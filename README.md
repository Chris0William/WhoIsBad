# spy-editor

一个伪装成 VSCode 代码编辑器的「谁是卧底」局域网联机游戏。

看起来你在认真写代码，实际上你在和同事玩游戏。

## 截图预览

```
┌─────────────────────────────────────────────┐
│ ● ● ●  spy-editor - Visual Studio Code     │
├────┬────────────────────────────────────────┤
│    │ room_A3F2.js ×                        │
│ 📁 ├────────────────────────────────────────┤
│    │  1 │ const myWord = "芒果";            │
│ 玩 │  2 │ // ---- 第 1 轮 · 描述阶段 ----  │
│ 家 │  3 │ // [玩家A] "比较甜的水果"         │
│ 列 │  4 │ // [玩家B] "可以做果汁"           │
│ 表 │  5 │ // [玩家C] "黄色的"              │
├────┼────────────────────────────────────────┤
│    │ > TERMINAL                              │
│    │ > 等待玩家B发言...                      │
├────┴────────────────────────────────────────┤
│ 🔌 Connected │ 房间: A3F2 │ 第 1 轮 │ UTF-8│
└─────────────────────────────────────────────┘
```

## 伪装映射

| 游戏元素 | 伪装成 |
|---------|--------|
| 游戏房间 | 文件标签页 |
| 玩家列表 | 侧边栏文件树 |
| 发言记录 | 编辑器中的代码注释 |
| 你的词语 | `const myWord = "xxx"` |
| 输入发言 | 终端命令输入 |
| 投票 | 终端选择按钮 |
| 游戏状态 | 状态栏 |

## 功能

- **WebSocket 实时通信**，局域网多人联机
- **三种难度词库**（简单 / 普通 / 困难，共 270+ 组词对）
- **平票加赛机制**（平票后限定发言和投票范围，直到决出结果）
- **断线重连** + 心跳保活
- **移动端响应式适配**
- **浏览器通知提醒**（切后台时标题闪烁 + 系统通知）

## 快速开始

```bash
# 安装依赖
npm install

# 启动服务器
node server.js
```

启动后终端会显示访问地址，例如：

```
服务器已启动:
  本机: http://localhost:3001
  局域网: http://192.168.1.100:3001
```

同一局域网的同事在浏览器访问该地址即可加入游戏。

## 游戏规则

### 角色

- **平民** — 拿到相同的词语，目标是找出卧底和白板
- **卧底** — 拿到与平民相似但不同的词语，目标是存活到最后
- **白板** — 没有任何词语，需要根据他人发言伪装

### 流程

1. 房主创建房间，设置人数、卧底数量、白板数量、词语难度
2. 玩家加入房间，房主开始游戏
3. 系统随机分配角色和词语
4. 每轮所有玩家依次提交文字描述（不能直接说出词语）
5. 所有人发言完毕后进入投票阶段
6. 得票最多的玩家出局并公布身份；平票则进入加赛
7. 胜负判定：
   - 卧底 + 白板全部出局 → **平民胜**
   - 存活卧底 ≥ 存活平民 → **卧底胜**
   - 卧底全部出局且白板存活 → **白板胜**

## 技术栈

- **后端**: Node.js + [ws](https://github.com/websockets/ws)（唯一依赖）
- **前端**: 纯 HTML / CSS / JavaScript，无框架
- **样式**: VSCode Dark+ 主题配色

## 项目结构

```
spy-editor/
├── server.js              # HTTP + WebSocket 服务入口
├── server/
│   ├── GameRoom.js        # 游戏房间状态机
│   ├── RoomManager.js     # 房间管理 & 消息路由
│   ├── protocol.js        # 消息协议
│   └── words.js           # 词库（三个难度）
├── public/
│   ├── index.html
│   ├── css/editor.css     # VSCode 深色主题样式
│   └── js/
│       ├── app.js         # WebSocket 连接 & 消息分发
│       ├── ui-lobby.js    # 大厅界面
│       ├── ui-game.js     # 游戏界面
│       └── protocol.js    # 前端消息协议
└── package.json
```

## License

MIT
